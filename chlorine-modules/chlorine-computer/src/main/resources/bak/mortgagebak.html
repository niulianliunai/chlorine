<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>房贷计算器</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <link rel="stylesheet" href="../static/jssdk/sdk.css"/>
    <link rel="stylesheet" href="../static/jssdk/helper.css"/>
    <link rel="stylesheet" href="../static/jssdk/iconfont.css"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 50px;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="number"], select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            font-size: 1.2em;
        }
        .schedule {
            margin-top: 20px;
        }
        .schedule table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .schedule th, .schedule td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        .schedule th {
            background-color: #f2f2f2;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div id="root" class="app-wrapper container"></div>
<script src="jssdk/sdk.js"></script>
<script type="text/javascript">
    (function () {
        let amis = amisRequire('amis/embed');
        let amisJSON = {
            "type": "page",
            "title": "房贷计算器",
            "body": [
                {
                    "type": "form",
                    "reload":"res",
                    "debug": true,
                    "className": "container",
                    "data": {
                        "principal": 895000,
                        "annualInterestRate": 3.6,
                        "loanTermYears": 30,
                        "repaymentType": "equalInstallment"
                    },
                    "body": [
                        {
                            "type": "input-number",
                            "name": "principal",
                            "label": "贷款本金（元）:",
                            "required": true,
                            "min": 0
                        },
                        {
                            "type": "input-number",
                            "name": "annualInterestRate",
                            "label": "年利率（%）:",
                            "step": "0.01",
                            "required": true,
                            "min": 0
                        },
                        {
                            "type": "select",
                            "name": "loanTermYears",
                            "label": "贷款期限（年）:",
                            "options": [
                                {"label": "1年", "value": "1"},
                                {"label": "5年", "value": "5"},
                                {"label": "10年", "value": "10"},
                                {"label": "15年", "value": "15"},
                                {"label": "20年", "value": "20"},
                                {"label": "25年", "value": "25"},
                                {"label": "30年", "value": "30"}
                            ],
                            "required": true
                        },
                        {
                            "type": "select",
                            "name": "repaymentType",
                            "label": "还款方式:",
                            "options": [
                                {"label": "等额本金", "value": "equalPrincipal"},
                                {"label": "等额本息", "value": "equalInstallment"}
                            ],
                            "required": true
                        },
                        {
                            "type": "tpl",
                            "tpl": "<h3>计算结果:</h3>",
                            "className": "result-header"
                        },
                        {
                            "type": "tpl",
                            "tpl": "${rows.monthlyPayment}",
                            "className": "result"
                        },
                        {
                            "type": "button",
                            "label": "计算",
                            "level": "primary",
                            "onEvent": {
                                "click": {
                                    "actions": [
                                        {
                                            "componentId": "res",
                                            "actionType": "reload",
                                            "api": {
                                                "url": "/calculate",
                                                "method": "get",
                                                "data": {
                                                    "principal": "${principal}",
                                                    "annualInterestRate": "${annualInterestRate}",
                                                    "loanTermYears": "${loanTermYears}",
                                                    "repaymentType": "${repaymentType}"
                                                },
                                                "messages": {
                                                    "success": "成功",
                                                    "failed": "失败"
                                                }
                                            }
                                        },
                                        {
                                            "actionType": "renderResult",
                                            "target": "result",
                                            "renderer": "tpl",
                                            "tpl": "每月还款金额: ${monthlyPayment} 元"
                                        },
                                        {
                                            "actionType": "reload",
                                            "target": "schedule"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                },
                {
                    "type": "table",
                    "name":"res",
                    "id":"res",
                    "className": "schedule",
                    "source": "$rows",
                    "columns": [
                        {
                            "name": "month",
                            "label": "期数",
                            "type": "text",
                            "align": "center"
                        },
                        {
                            "name": "monthlyPayment",
                            "label": "月供（元）",
                            "type": "text",
                            "align": "right"
                        },
                        {
                            "name": "principalPayment",
                            "label": "本金（元）",
                            "type": "text",
                            "align": "right"
                        },
                        {
                            "name": "interestPayment",
                            "label": "利息（元）",
                            "type": "text",
                            "align": "right"
                        },
                        {
                            "name": "remainingPrincipal",
                            "label": "剩余本金（元）",
                            "type": "text",
                            "align": "right"
                        }
                    ]
                }
            ]
        };

        let amisScoped = amis.embed('#root', amisJSON);
    })();
</script>
</body>
</html>
